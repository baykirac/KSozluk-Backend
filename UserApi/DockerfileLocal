FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build
WORKDIR /app

COPY *.csproj ./
RUN dotnet restore

COPY . .

RUN dotnet publish -c Release -o out

FROM mcr.microsoft.com/dotnet/aspnet:7.0 AS runtime
WORKDIR /app
COPY --from=build /app/out ./

EXPOSE 80

ENTRYPOINT ["dotnet", "UserApi.dll"]

#dotnet dev-certs https -ep ${HOME}/.aspnet/https/UserApi.pfx -p user-api-1234

#dotnet user-secrets -p UserApi.csproj set "Kestrel:Certificates:Development:Password" "user-api-1234"

# docker build -t core-user-api-local . -f DockerfileLocal

# docker run -d --rm -p 5173:80 -p 6103:443 -e ASPNETCORE_URLS="https://+;http://+" -e ASPNETCORE_HTTPS_PORT=8001 -e ASPNETCORE_ENVIRONMENT=Development -e ASPNETCORE_Kestrel__Certificates__Development__Password="user-api-1234" -v ${HOME}/.microsoft/usersecrets/:/root/.microsoft/usersecrets -v ${HOME}/.aspnet/https:/root/.aspnet/https/ core-user-api-local 
